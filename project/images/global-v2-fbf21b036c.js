var Util=Util||{};Util.flag={productLikeFlag:1,topicCollectFlag:1},Util.pageSize=function(){var i=document.documentElement,t=["clientWidth","clientHeight","scrollWidth","scrollHeight"],e={};for(var a in t)e[t[a]]=i[t[a]];return e.scrollLeft=document.body.scrollLeft||document.documentElement.scrollLeft,e.scrollTop=document.body.scrollTop||document.documentElement.scrollTop,e},Util.DownloadShow=function(i){var t='<div class="left-bg"><img src="/img/download-model-left.jpg"/></div><div class="code"><img src="http://7xo1vw.com1.z0.glb.clouddn.com/qrcode/qrcode.png" alt=""/></div><p class="desc">扫描二维码，下载APP</p>',e={maskerID:"downloadModelOverlay",contentID:"downloadModelContent",alpha:.6,bgColor:"#000",dbclick:!0,keydown:!0,mZindex:9997,cZindex:9999,height:410,contentHTML:t};if(i&&"object"==typeof i)for(var a in i)a.match(/^_/)||(e[a]=i[a]);var s=Util.pageSize().scrollWidth,l=Util.pageSize().scrollHeight;$(window).size(function(){s=Util.pageSize().scrollWidth,l=Util.pageSize().scrollHeight});var c=Math.floor((Util.pageSize().clientHeight-e.height)/2),n='<div id="'+e.maskerID+'" style="position:fixed;left:0;top:0;right:0;bottom:0;z-index:'+e.mZindex+';background-color:rgba(0,0,0,.7);opacity:0;"><div class="model-close-area"><i class="icons model-close"></i></div></div>',o='<div id="'+e.contentID+'" class="model-dialog" style="z-index:'+e.cZindex+";top:"+c+'px;opacity:0;transition: all .3s ease-out;transform:translate(0,-20px)">';o+=e.contentHTML,o+="</div>",$(n).appendTo("body"),$(o).appendTo("body");var r=$("#"+e.maskerID),d=$("#"+e.contentID);setTimeout(function(){r.css("opacity","1"),d.css({opacity:"1",transform:"translate(0,0)"})},20);var p=$(".icon-close");p&&p.click(function(){Util.modelClose(r,d)}),e.dbclick&&r.click(function(i){i=i||window.event;i.srcElement?i.srcElement:i.target;Util.modelClose(r,d)}),e.keydown&&(document.onkeydown=function(i){i=window.event||i;i.keyCode||i.which||i.charCode;27==i.keyCode&&Util.modelClose(r,d)})},Util.modelClose=function(i,t){i.css("opacity","0"),t.css({opacity:"0",transform:"translate(0,-20px)"}),setTimeout(function(){i.remove(),t.remove()},300)},Util.scrollHeader=function(){$(window).on("scroll",function(){$(document).scrollTop()>=200?$("body").removeClass("home-header"):$("body").addClass("home-header")})},Util.loginModel=function(i){function t(){v.hide(),p.show()}function e(){p.hide(),v.show()}function a(){var t=$("#loginMobile").val(),e=$("#loginPwd").val(),a=$("#loginErr");return t?e?void $.ajax({url:"/account/login",type:"POST",dataType:"json",data:{mobile:t,password:e},beforeSend:function(){},success:function(t){1==t.code?i?(Util.modelClose($("#downloadModelOverlay"),$("#loginModelContent")),window.location.href.indexOf("/article/edit")>0&&setInterval(function(){ArticleUtil.saveJSON($(".edit-content"),"edit-unit",1)},3e4)):window.location.reload():a.html(t.msg)}}):void a.html("请输入密码"):void a.html("请输入手机号")}function s(){var i=$("#regMobile").val(),t=$("#regErr");return i?void $.ajax({url:"/account/sendMobileCode",type:"POST",dataType:"json",data:{mobile:i},beforeSend:function(){},success:function(i){1==i.code?l():t.html(i.msg)}}):void t.html("请输入手机号")}function l(){k.hasClass("disabled")||(k.unbind("click").addClass("disabled"),w=setInterval(function(){0>=b?(clearInterval(w),w=null,k.html("获取验证码").bind("click",function(){s()}).removeClass("disabled"),b=59):(k.html(b+"秒后重新获取"),b--)},1e3))}function c(){var i=$("#regMobile").val(),t=$("#regAuthCode").val(),e=$("#regPwd").val(),a=$("#regErr");return i?t?e?void $.ajax({url:"/account/register",type:"POST",dataType:"json",data:{mobile:i,password:e,randCode:t},beforeSend:function(){},success:function(i){1==i.code?window.location.reload():a.html(i.msg)}}):void a.html("请输入密码"):void a.html("请输入验证码"):void a.html("请输入手机号")}var n='<div class="model-inner"><div class="code-area"></div><div class="log-reg-area"><div class="inner"><div class="login-area"><input type="text" id="loginMobile" placeholder="手机号"/><input type="password" id="loginPwd" placeholder="密码"/><p class="err-msg" id="loginErr"></p><a href="javascript:;" class="btn" id="loginBtn">登录</a><p class="toggle" id="showReg">注册</p></div><div class="reg-area"><input type="text" id="regMobile" placeholder="手机号"/><input class="auth-code" type="text" id="regAuthCode" placeholder="验证码"/><a class="btn auth-code-btn" id="getAuthCodeBtn">获取验证码</a><div class="clear"></div><input type="password" id="regPwd" placeholder="密码"/><p class="err-msg" id="regErr"></p><a href="javascript:;" class="btn reg-btn" id="regBtn">注册</a><p class="toggle" id="showLogin">登录</p></div><p class="third-title">社交账号快速登录</p><div class="third"><a target="_blank" title="微博登录" href="/account/oauth2/weibo/" class="item weibo"><i class="icons weibo-login"></i><p>微博</p></a><a target="_blank" title="QQ登录" href="/account/oauth2/qq/" class="item qq"><i class="icons qq-login"></i><p>QQ</p></a></div></div></div></div>',o={contentID:"loginModelContent",height:580,contentHTML:n};Util.DownloadShow(o);var r=$("#showLogin"),d=$("#showReg"),p=$(".login-area"),v=$(".reg-area"),u=$(".third .item");u.click(function(){Util.modelClose($("#downloadModelOverlay"),$("#loginModelContent"))}),r.click(function(){t()}),d.click(function(){e()});var f=$("#loginBtn"),h=$("#loginPwd"),m=$("#regPwd"),g=$("#regBtn"),k=$("#getAuthCodeBtn");f.click(function(){a()}),h.on("keyup",function(i){var t=i.keyCode;13==t&&a()}),k.click(function(){s()}),g.click(function(){c()}),m.on("keyup",function(i){var t=i.keyCode;13==t&&c()});var b=59,w=null},Util.shareOption=function(i,t){switch(i){case"weixin":var e=window.location.href,a=[];if(e.match(/\/topic\/[0-9]+/g)){a=e.match(/\/topic\/[0-9]+/g);var s=a[0].substring(7);e="http://m.ibantang.com/topic/"+s+"/?ref=webshare&cate=weixin"}else if(e.match(/\/product\/[0-9]+/g)){a=e.match(/\/product\/[0-9]+/g);var l=a[0].substring(9);e="http://m.ibantang.com/product/"+l+"/?ref=webshare&cate=weixin"}else if(e.match(/\/post\/[0-9]+/g)){a=e.match(/\/post\/[0-9]+/g);var c=a[0].substring(6);e="http://m.ibantang.com/post/"+c+"/?ref=webshare&cate=weixin"}var n="http://s.jiathis.com/qrcode.php?url="+encodeURIComponent(e),o='<div class="left-bg"><img src="/img/download-model-left.jpg"/></div><div class="code"><img src="'+n+'"/></div><p class="desc">打开微信扫一扫，即可分享给好友</p>';Util.DownloadShow({contentHTML:o});break;case"weibo":var r="http://service.weibo.com/share/share.php?";r+="url="+encodeURIComponent(location.href+"?ref=webshare&cate=weibo"),r+="&appkey=2463269013",r+="&pic="+$("#sharePic").val(),r+="&title="+$("#shareTitle").val(),r+="&ralateUid=5433854539",r+="&searchPic=false",t.attr("href",r);break;case"qq-space":var r="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";r+="url="+encodeURIComponent(location.href+"?ref=webshare&cate=qq_space"),r+="&pics="+$("#sharePic").val().replace(/\|\|/g,"|"),r+="&title="+$("#shareTitle").val(),t.attr("href",r);break;case"qq":var r="http://connect.qq.com/widget/shareqq/index.html?";r+="url="+encodeURIComponent(location.href+"?ref=webshare&cate=qq_friends"),r+="&site="+encodeURIComponent("半糖"),r+="&desc="+$("#shareTitle").val(),t.attr("href",r)}},Util.scrollToTop=function(i){var t=$("body,html");20>i?t.scrollTop(0):t.stop(!0,!0).animate({scrollTop:0},i)},Util.sideFixedMenu=function(i,t,e,a){if(i&&t&&!(t.length<=0)){e||(e=2e3);var s=$(document),l=($("body"),i.width()),c=Math.floor(l/2)+40,n="";n+='<div class="side-fixed-menu" style="margin-left: '+c+'px;">';for(var o=0,r=t.length;r>o;o++)switch(t[o]){case"back-to-top":n+='<div class="menu-item" id="backToTop">',n+='<i class="bt-iconfont if-back-to-top"></i>',n+="<p>返回顶部</p>",n+="</div>";break;case"topic-like":n+='<div class="menu-item'+(a?" liked":"")+'" id="topicLike">',n+='<i class="bt-iconfont if-like"></i>',n+="<p>"+(a?"取消收藏":"收藏清单")+"</p>",n+="</div>";break;case"product-like":n+='<div class="menu-item'+(a?" liked":"")+'" id="productLike">',n+='<i class="bt-iconfont if-like"></i>',n+="<p>"+(a?"取消收藏":"收藏单品")+"</p>",n+="</div>"}n+="</div>";var d=$(n);d.find("#backToTop").on("click",function(){Util.scrollToTop(300)}),d.find("#productLike").on("click",function(){var i=$(this),t=1;i.hasClass("liked")&&(t=2);var e=$("#productId").val();Util.productLike(e,t,i)}),d.find("#topicLike").on("click",function(){var i=$(this),t=1;i.hasClass("liked")&&(t=2);var e=$("#topicId").val();Util.topicCollect(e,t,i)}),d.appendTo($("body")),$(window).on("scroll",function(){var i=s.scrollTop();i>e?d.fadeIn(100):d.fadeOut(100)})}},Util.allCateStruct=function(i,t,e,a){function s(s){var l=50,c="",n="";n+='<div class="cate-content-area" style="left:'+t+'px;">',c+='<div class="cate-struct-area" style="width:'+t+'px;">',c+='<p class="title">全部分类</p><div class="h-dashed-3"></div>',c+='<ul class="cate-1-list">';for(var o=0,r=s.length;r>o;o++){l+=e+1,c+='<li data-id="'+s[o].id+'" data-level="1" d-i="'+o+'" data-index="'+o+'" style="height:'+e+"px;line-height:"+e+'px;"><i class="before-arr"></i><p>'+s[o].name+'</p><div class="h-dashed-3"></div><i class="after-arr"></i></li>';var d=s[o].subCate;n+='<div data-index="'+o+'" class="cate-2-list">',n+='<div class="inner">';for(var p=0,v=d.length;v>p;p++){var u="http://7viiaj.com2.z0.glb.qiniucdn.com/newcategory/";u+=(1*d[p].pid+1e3).toString().substring(1),u+="/"+(1*d[p].id+1e3).toString().substring(1)+".png",n+='<div class="cate-2-list-item">',n+='<div class="pic"><img src="'+u+'"/></div>',n+='<div class="info">',n+='<p data-id="'+d[p].id+'" data-level="2" d-i="'+o+'" d-j="'+p+'" class="title cate-unit">'+d[p].name+"</p>",n+='<ul class="cate-3-list clearfix">';for(var f=d[p].subCate,h=0,m=f.length;m>h;h++)n+='<li class="cate-unit" data-id="'+f[h].id+'" data-level="3" d-i="'+o+'" d-j="'+p+'" d-k="'+h+'">'+f[h].name+"</li>";n+="</ul>",n+="</div>",n+="</div>",p%3==2&&(n+='<div class="clear"></div>')}n+='<div class="clear"></div>',n+="</div>",n+="</div>"}c+="</ul>",c+="</div>",n+="</div>";var g=$(n),k=$(c);k.append(g),k.find(".cate-unit").click(function(){var i=$(this);$(".cate-1-list li.selected").removeClass("selected"),$($(".cate-1-list li")[i.attr("d-i")]).addClass("selected"),a(s,i.attr("data-level"),i.attr("data-id"),i.attr("d-i"),i.attr("d-j"),i.attr("d-k")),$(".cate-2-list").css("z-index","1").hide()});var b=k.find(".cate-1-list li");b.each(function(){var i=$(this).attr("data-index"),t=k.find(".cate-2-list[data-index="+i+"]");t.find(".inner").css("min-height",50*(1*i+2)-70+"px");var a=0,s=Math.floor(50+i*(e+1)+e/2),l=s-a;t.css("top",a+"px"),t.find(".inner .before-arr").css("top",l+"px"),t.find(".inner .after-arr").css("top",l+"px")}),b.on("mouseenter",function(){var i=$(this);i.find("i").css("display","block");var t=$(this).attr("data-index"),e=k.find(".cate-2-list[data-index="+t+"]"),a=$(document).scrollTop();if(a>30){var s=a-30;e.css("top",s+"px"),e.find(".inner").css("min-height",50*(1*t+2)-70-s+"px")}else e.css("top","0px"),e.find(".inner").css("min-height",50*(1*t+2)-70+"px");e.css("z-index","10").show()}).on("mouseleave",function(){var i=$(this);i.find("i").css("display","none");var t=$(this).attr("data-index");k.find(".cate-2-list[data-index="+t+"]").css("z-index","1").hide()}),g.find(".cate-2-list").on("mouseenter",function(){var i=$(this),t=i.attr("data-index");k.find(".cate-1-list li[data-index="+t+"]").find("i").css("display","block"),$(this).css("z-index","10").show()}).on("mouseleave",function(){var i=$(this),t=i.attr("data-index");k.find(".cate-1-list li[data-index="+t+"]").find("i").css("display","none"),$(this).css("z-index","1").hide()}),i.html("").append(k)}$.ajax({url:"/g/allCates",type:"GET",dataType:"json",data:{},success:function(i){s(i)}})},Util.scrollEvent=function(i,t){$(document).on("scroll",function(){var e=$(document).scrollTop(),a=Util.pageSize().scrollHeight,s=Util.pageSize().clientHeight;e+s>=a-t&&i()})},Util.createTopicList=function(i,t,e,a){for(var s="",l=0,c=e.length;c>l;l++){var n=e[l];if((2!=n.type||0!=n.type_id)&&6!=n.type){var o=n.cover||n.pic||n.pics&&n.pics.length>0&&n.pics[0].url||"";a&&"recommend"==a&&n.pics&&n.pics.length>0&&(o=n.pics[0].url),o=o.replace("!300x300","!w600");var r=n.description?n.description:n.desc;s+='<div class="topic-item">',s+='<a target="_blank" title="'+n.title+'" href="/topic/'+n.id+'/">',s+='<div class="cover-area"><div class="cover"><img src="'+o+'" alt="'+n.title+'"/></div></div>',s+='<div class="detail">',s+='<p class="title">'+n.title+"</p>",s+='<p class="desc">'+r||"</p>",s+='<div class="info">',s+='<div class="stat">',s+='<i class="bt-iconfont if-view"></i>'+(n.views||"0"),s+='<i class="bt-iconfont if-like pl"></i>'+(n.likes||"0"),s+="</div>",s+="</div>",s+="</div>",s+="</a>",s+="</div>"}}1==t?i.html(s):i.append(s)},Util.createTopicListV2=function(i,t,e){for(var a="",s=0,l=e.length;l>s;s++){var c=e[s];if((2!=c.type||0!=c.type_id)&&6!=c.type){var n=c.pic||c.pics[0].url;a+='<div class="topic-item">',a+='<a target="_blank" title="'+c.title+'" href="/topic/'+c.id+'/">',a+='<div class="cover-area"><div class="cover"><img src="'+n+'" alt="'+c.title+'"/></div></div>',a+='<div class="detail">',a+='<p class="title elli">'+c.title+"</p>",a+='<p class="desc">'+c.desc+"</p>",a+='<div class="info">',a+='<div class="user">',a+='<div class="avatar" style="background-image: url('+c.user.avatar+');"></div>',a+='<p class="nickname">'+c.user.nickname+"</p>",a+="</div>",a+='<div class="stat">',a+='<i class="bt-iconfont if-view"></i>'+(c.views||"0"),a+='<i class="bt-iconfont if-like pl"></i>'+(c.likes||"0"),a+="</div>",a+="</div>",a+="</div>",a+="</a>",a+="</div>"}}0==t?i.html(a):i.append(a)},Util.createTopicListV3=function(i,t,e){for(var a="",s=0,l=e.length;l>s;s++){var c=e[s];if((2!=c.type||0!=c.type_id)&&6!=c.type){var n=c.pic||c.pics[0].url;a+='<div class="topic-item-v3">',a+='<a target="_blank" title="'+c.title+'" href="/topic/'+c.id+'/">',a+='<div class="cover-area"><img class="lazy new" data-original="'+n+'" alt="'+c.title+'"/></div>',a+='<p class="title elli">'+c.title+"</p>",a+='<div class="info">',a+='<div class="user">',a+='<div class="avatar" style="background-image: url('+c.user.avatar+');"></div>',a+='<p class="nickname elli">'+c.user.nickname+"</p>",a+="</div>",a+='<div class="stat">',a+='<i class="bt-iconfont if-view"></i>'+(c.views||"0"),a+='<i class="bt-iconfont if-like pl"></i>'+(c.likes||"0"),a+="</div>",a+="</div>",a+="</a>",a+="</div>"}}0==t?i.html(a):i.append(a),Util.lazyLoad("lazy.new"),$(".lazy.new").removeClass(".new")},Util.createProductList=function(i,t,e){for(var a="",s=0,l=e.length;l>s;s++){var c=e[s].pic;c||(c=e[s].picUrl),a+='<div class="goods-item"><a target="_blank" title="'+e[s].title+'" href="/product/'+e[s].id+'/"><div class="cover"><img src="'+c+'" alt="'+e[s].title+'"/></div><p class="title elli">'+e[s].title+'</p><p class="stat"><span class="price">&yen;'+e[s].price+'</span><span class="like"><i class="icons topic-item-like"></i>'+e[s].likes+"</span></p></a></div>"}1==t?i.html(a):i.append(a)},Util.createProductListV2=function(i,t){for(var e="",a=0,s=t.length;s>a;a++){var l=t[a];e+='<a target="_blank" title="'+l.title+'" href="/product/'+l.id+'/">',e+='<div class="product-item-v2">',e+='<div class="pic"><img class="lazy new" data-original="'+l.pic+'" alt="'+l.title+'"></div>',e+='<p class="title elli">'+l.title+"</p>",e+='<p class="info">',e+='<span class="price number-font">&yen;'+l.price+"</span>",e+='<span class="like"><i class="bt-iconfont if-like"></i>'+(l.likes||"喜欢")+"</span>",e+="</p>",e+="</div>",e+="</a>"}i.append(e),Util.lazyLoad("lazy.new"),$(".lazy.new").removeClass(".new")},Util.createSinglePicProductList=function(i,t,e){for(var a="",s=0,l=e.length;l>s;s++){var c=e[s].pic;c||(c=e[s].picUrl),a+='<div class="goods-item"><a title="'+e[s].title+'" href="/product/'+e[s].id+'/"><div class="cover"><img src="'+c+'" alt="'+e[s].title+'"/></div></a></div>'}1==t?i.html(a):i.append(a)},Util.createPostList=function(i,t,e){for(var a="",s=0,l=e.length;l>s;s++){var c=e[s],n=c.id,o=c.middle_pic_url;o||(o=c.PostPics[0].url),o=o.replace("!w300","/300x300");var r="",d="",p="";c.user?(r=c.user.avatar,d=c.user.nickname,p=c.user.user_id):(r=c.UserProfile.avatar,d=c.UserProfile.nickname,p=c.UserProfile.user_id);var v=0;v=c.dynamic?c.dynamic.likes:c.likes;var u=c.content;a+='<div class="post-item"><a target="_blank" title="'+d+'的分享" href="/post/'+n+'/"><div class="cover"><img src="'+o+'" alt="'+d+'的分享"/></div></a><div class="info"><div class="user"><a target="_blank" title="'+d+'的首页" href="/u/'+p+'/"><div class="avatar" style="background-image: url('+r+');filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+r+'", sizingMethod=scale);"></div></a><p class="nickname elli">'+d+'</p></div><span class="like"><i class="icons topic-item-like"></i>'+v+'</span></div><p class="content">'+(u.length>44?u.substring(0,44)+"...":u)+"</p></div>"}1==t?i.html(a):i.append(a)},Util.createPostListV3=function(i,t){for(var e="",a=0,s=t.length;s>a;a++){var l=t[a];e+='<a target="_blank" href="/post/'+l.id+'/">',e+='<div class="post-item-v3">',e+='<div class="pic"><img class="lazy new" data-original="'+(l.pics&&l.pics.length>0?l.pics[0].url:l.middle_pic_url)+'"></div>',e+='<div class="info">',e+='<div class="user">',e+='<div class="avatar" style="background-image: url('+l.user.avatar+');"></div>',e+='<p class="nickname elli">'+l.user.nickname+"</p>",e+="</div>",e+='<span class="like"><i class="bt-iconfont if-like"></i>'+(l.dynamic.likes||"喜欢")+"</span>",e+="</div>",e+='<p class="content">'+l.content+"</p>",e+="</div>",e+="</a>"}i.append(e),Util.lazyLoad("lazy.new"),$(".lazy.new").removeClass(".new")},Util.createLikeBoxList=function(i,t,e){for(var a="",s=0,l=e.length;l>s;s++)a+='<div data-id="'+e[s].id+'" data-title="'+e[s].title+'" data-count="'+e[s].count+'" class="like-box-item"><div class="cover" style="background-image: url('+e[s].cover+');filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+e[s].cover+'", sizingMethod=scale);"></div><p class="title">'+e[s].title+'</p><p class="stat">'+e[s].count+"&nbsp;单品</p></div>";1==t?i.html(a):i.append(a)},Util.productLike=function(i,t,e){Util.flag.productLikeFlag&&$.ajax({url:"/product/like",type:"GET",dataType:"json",data:{productId:i,type:t},beforeSend:function(){Util.flag.productLikeFlag=0},success:function(i){1==i.code?1==t?(e.addClass("liked"),e.hasClass("menu-item")&&e.find("p").css("top","40px").html("取消收藏"),e.find(".like-count").length>0&&e.find(".like-count").html("已喜欢"),Util.likeOptTips("成功添加至「我的喜欢」")):(e.removeClass("liked"),e.hasClass("menu-item")&&e.find("p").css("top","40px").html("收藏单品"),e.find(".like-count").length>0&&e.find(".like-count").html(e.attr("data-likes"))):-2==i.code?Util.loginModel():console.log(i.msg),Util.flag.productLikeFlag=1}})},Util.productLikeEvent=function(){var i=$(".product-card .pc-like-area");i.click(function(){var i=$(this),t=i.data("product-id");if(t&&"undefined"!=t){var e=1;i.hasClass("liked")&&(e=2),Util.productLike(t,e,i)}})},Util.topicCollect=function(i,t,e){Util.flag.topicCollectFlag&&$.ajax({url:"/topic/collect",type:"GET",dataType:"json",data:{topicId:i,type:t},beforeSend:function(){Util.flag.topicCollectFlag=0},success:function(i){1==i.code?1==t?(e.addClass("liked"),e.hasClass("menu-item")&&e.find("p").css("top","40px").html("取消收藏"),Util.likeOptTips("成功收藏至我的「清单」")):(e.removeClass("liked"),e.hasClass("menu-item")&&e.find("p").css("top","40px").html("收藏清单")):-2==i.code?Util.loginModel():console.log(i.msg),Util.flag.topicCollectFlag=1}})},Util.likeOptTips=function(i){var t='<div class="like-opt-tips">';t+='<i class="icons like-tips"></i>',t+="<p>"+i+"</p>",t+="</div>";var e=$(".suser-area");e.prepend(t),setTimeout(function(){e.find(".like-opt-tips").css("opacity","0")},2e3)},Util.loadTopicComment=function(i,t,e,a){$.ajax({url:"/topic/getComments",type:"GET",dataType:"json",data:{id:i,page:t,pagesize:e},success:function(i){1==i.code&&a(i.data)}})},Util.createTopicCommentsHTML=function(i,t){for(var e="",a=0,s=i.length;s>a;a++){var l=i[a];e+='<li class="comment-item" data-comment-id="'+l.id+'">',e+='<a target="_blank" title="'+l.user.nickname+'的首页" href="/u/'+l.user.user_id+'">',e+='<div class="avatar" style="background-image: url('+l.user.avatar+');"></div>',e+="</a>",e+='<div class="info">',e+='<p class="nickname">',e+='<a href="javascript:;">'+l.user.nickname+"</a>",e+="</p>",e+='<p class="content">'+(l.at_user.nickname?"回复<span>@"+l.at_user.nickname+"：</span>":"")+l.conent+"</p>",e+='<p class="stats">'+l.datestr+"</p>",e+="</div>",e+="</li>"}$(t).append(e)},Util.loadCommentV2=function(){function i(i,t,e){var a="";"topic"==s?a="/topic/addComment":"post"==s&&(a="/post/addComment"),$.ajax({url:a,type:"POST",dataType:"json",data:{id:l,content:i,atUserId:t,atCommentId:e},beforeSend:function(){},success:function(i){1==i.code?(alert("评论发布成功，正在审核中"),window.location.reload()):-2==i.code&&Util.loginModel()},error:function(){}})}function t(){0!=f&&$.ajax({url:h,type:"GET",dataType:"json",data:{id:l,page:v,pagesize:u},beforeSend:function(){f=0},success:function(i){1==i.code&&(e(i.data,r),i.data.length>=u?(v++,f=1,p.css("display","block")):(p.css("display","none"),$(".comment-item:last-child").css("border-bottom","none")))}})}function e(t,e){for(var a="",s=0,l=t.length;l>s;s++){var c=t[s];a+='<li class="comment-item">',a+='<a target="_blank" title="'+c.user.nickname+'的首页" href="/u/'+c.user.user_id+'/">',a+='<div class="avatar" style="background-image: url('+c.user.avatar+');"></div>',a+="</a>",a+='<div class="info">',a+='<p class="nickname">',a+='<a href="javascript:;">'+c.user.nickname+"</a>",a+="</p>",a+='<p class="content">'+c.conent+"</p>",c.at_comment&&c.at_comment.id&&(a+='<p class="at-comment"><span class="at-user">'+c.at_comment.user.nickname+"：</span>"+c.at_comment.conent+"</p>"),a+='<p class="stats">'+c.datestr+'<span class="reply-btn">回复</span></p>',a+='<div class="reply-area"><div class="reply-con-area"><textarea class="reply-con" placeholder="回复 @'+c.user.nickname+'"></textarea></div><div class="reply-btn-area"><a href="javascript:;" class="reply-commit" data-uid="'+c.user.user_id+'" data-cid="'+c.id+'">发布</a><a href="javascript:;" class="reply-cancel">取消</a></div></div>',a+="</div>",a+="</li>"}a=$(a),a.find(".reply-btn").on("click",function(){var i=$(this).parent().parent().parent();i.find(".reply-area").css("height","auto")}),a.find(".reply-cancel").on("click",function(){$(this).parent().parent().css("height","0")}),a.find(".reply-commit").on("click",function(){var t=$(this),e=t.parent().parent(),a=e.find(".reply-con").val();i(a,t.data("uid"),t.data("cid"))}),$(e).append(a)}var a=$(".comment-area-v2");if(a&&!(a.length<=0)){var s=a.data("type"),l=a.data("id"),c='<div class="add-comment">';c+='<p class="head">评论</p>',c+='<div class="text-area">',c+='<textarea class="add-con" placeholder="我也来说两句"></textarea>',c+='<a href="javascript:;" class="btn">发表评论</a>',c+="</div>",c+="</div>";var n=$(c);n.find(".text-area .btn").on("click",function(){var t=n.find(".add-con").val();i(t,null,null)});var o='<ul class="comment-list"></ul>',r=$(o),d='<a href="javascript:;" class="more-comment">查看更多评论</a>',p=$(d);p.on("click",function(){t()}),a.append(n).append(r).append(p);var v=0,u=20,f=1,h="";if("topic"==s)h="/topic/getComments";else{if("post"!=s)return;h="/post/getComments"}t()}},Util.loadTopicRelationRec=function(i,t){var e=function(i){if(!(i.length<=0)){var e=3;i.length<3&&(e=i.length);for(var a='<div class="relation-rec"><h4 class="head">相关专题</h4>',s=0;e>s;s++){var l=i[s];a+='<a href="/topic/'+l.id+'/">',a+='<div class="relation-rec-item"><div class="rr-cover" style="background-image: url('+(l.pic||l.pics[0].url)+');"></div><div class="rr-info"><p class="rr-title elli">'+l.title+'</p><div class="rr-stat"><div class="rr-user"><div class="rr-avatar" style="background-image: url('+l.user.avatar+');"></div><p class="rr-nickname">'+l.user.nickname+'</p></div><div class="rr-count"><i class="bt-iconfont if-view"></i>'+l.views+"</div></div></div></div>",a+="</a>"}a+="</div>",t.html(a)}};$.ajax({url:"/topic/relationRec",type:"GET",dataType:"json",data:{id:i},success:function(i){1==i.code&&e(i.data.topic)}})},Util.loadTopicHotList=function(i,t,e){var a=function(i){if(!(i.length<=0)){var a=e||2;i.length<a&&(a=i.length);for(var s='<div class="relation-rec">',l=0;a>l;l++){var c=i[l];s+='<a href="/topic/'+c.id+'/">',s+='<div class="relation-rec-item"><div class="rr-cover" style="background-image: url('+(c.pic||c.pics[0].url)+');"></div><div class="rr-info"><p class="rr-title">'+c.title+'</p><div class="rr-stat"><div class="rr-user"><div class="rr-avatar" style="background-image: url('+c.user.avatar+');"></div><p class="rr-nickname">'+c.user.nickname+'</p></div><div class="rr-count"><i class="bt-iconfont if-view"></i>'+c.views+"</div></div></div></div>",s+="</a>"}s+="</div>",t.html(s)}};$.ajax({url:"/topic/hotList",type:"GET",dataType:"json",data:{typeId:0},success:function(i){1==i.code&&a(i.data.topic)}})},Util.shareAreaInit=function(){var i=$(".share-area-v2"),t='<p class="share-title">分享给朋友</p>';t+='<div class="share-list">',t+='<a href="javascript:;" class="share-item wx-share-show"><i class="share-icon share-icon-weixin-friend"></i></a>',t+='<a href="javascript:;" class="share-item wx-share-show"><i class="share-icon share-icon-weixin-timeline"></i></a>',t+='<a href="javascript:;" target="_blank" class="share-item wb-share-show"><i class="share-icon share-icon-weibo"></i></a>',t+='<a href="javascript:;" target="_blank" class="share-item qq-share-show"><i class="share-icon share-icon-qzone"></i></a>',t+='<a href="javascript:;" target="_blank" class="share-item qq-share-show"><i class="share-icon share-icon-qq"></i></a>',t+="</div>",i.html(t)},Util.rightSideFix=function(i){i=i||30;var t=$(".wrapper-950-r .inner");$(window).on("scroll",function(){$(document).scrollTop()>=i?t.addClass("fixed"):t.removeClass("fixed")})},Util.lazyLoad=function(i){var t=$("."+i);t.each(function(){var i=$(this),t=i.attr("data-original");$("<img />").one("load",function(){i.is("img")?i.attr("src",t):i.css("background-image","url("+t+")"),setTimeout(function(){i.css("opacity","1")},15)}).one("error",function(){i.css("opacity","1")}).attr("src",t)})},$(function(){function i(i){window.location.href="/search?q="+i}var t=$("#searchForm"),e=t.find("input"),a=t.find("a");e.on("focus",function(){"搜索你想要的"==$(this).val()&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val("搜索你想要的")}).on("keyup",function(t){var e=t.keyCode,a=$(this).val();13==e&&a&&i(a)}),a.bind("click",function(){var t=e.val();"搜索你想要的"!=t.trim()&&i(t)}),Util.productLikeEvent(),Util.loadCommentV2();var s=$(".collect-btn");s.on("click",function(){var i=$(this),t=i.data("tid");i.hasClass("liked")?Util.topicCollect(t,2,i):Util.topicCollect(t,1,i)}),Util.shareAreaInit(),$(".login-btn").click(function(){Util.loginModel()}),$(".download-show").on("click focus",function(){Util.DownloadShow()}),$(".wx-share-show").click(function(){Util.shareOption("weixin")}),$(".wb-share-show").click(function(){Util.shareOption("weibo",$(this))}),$(".qs-share-show").click(function(){Util.shareOption("qq-space",$(this))}),$(".qq-share-show").click(function(){Util.shareOption("qq",$(this))}),$("[data-ga-event]").click(function(){var i=$(this),t=i.attr("data-ga-event"),e=t.split(":");"undefined"!=typeof ga&&e.length>=3&&ga("send","event",e[0],e[1],e[2])});var l=$(".seo-desc"),c=l.find(".head");c.on("click",function(){l.hasClass("active")?l.removeClass("active").css("height","46px"):l.addClass("active").css("height","auto")}),$("body").append('<a href="http://www.sqkb.com/" target="_blank" title="省钱快报" class="sqkb"></a>')});